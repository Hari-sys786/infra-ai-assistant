<div class="upload-container">
  <div class="upload-header">
    <h2>Document Management</h2>
    <p class="subtitle">Upload PDFs and HTML files to index them for RAG retrieval</p>
  </div>

  <!-- Upload Zone -->
  <mat-card class="upload-card">
    <mat-card-header>
      <mat-card-title>Upload Document</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="vendor-field">
        <mat-form-field appearance="outline">
          <mat-label>Vendor / Category</mat-label>
          <input matInput [(ngModel)]="vendor" placeholder="e.g., Cisco, Dell, Custom" />
        </mat-form-field>
      </div>

      <div
        class="drop-zone"
        [class.dragging]="isDragging"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()"
      >
        <mat-icon class="drop-icon">cloud_upload</mat-icon>
        <p>Drag & drop a PDF or HTML file here</p>
        <p class="drop-hint">or click to browse</p>
        <input #fileInput type="file" accept=".pdf,.html,.htm" (change)="onFileSelected($event)" hidden />
      </div>

      <div class="upload-status" *ngIf="uploadProgress">
        <mat-progress-bar *ngIf="isUploading" mode="indeterminate"></mat-progress-bar>
        <p>{{ uploadProgress }}</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Documents Table -->
  <mat-card class="docs-card">
    <mat-card-header>
      <mat-card-title>
        Indexed Documents
        <span class="chip">{{ totalChunks }} chunks</span>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="documents" class="docs-table" *ngIf="documents.length > 0">
        <ng-container matColumnDef="vendor">
          <th mat-header-cell *matHeaderCellDef>Vendor</th>
          <td mat-cell *matCellDef="let doc">
            <span class="vendor-badge">{{ doc.vendor }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="document">
          <th mat-header-cell *matHeaderCellDef>Document</th>
          <td mat-cell *matCellDef="let doc">{{ doc.document }}</td>
        </ng-container>

        <ng-container matColumnDef="chunk_count">
          <th mat-header-cell *matHeaderCellDef>Chunks</th>
          <td mat-cell *matCellDef="let doc">{{ doc.chunk_count }}</td>
        </ng-container>

        <ng-container matColumnDef="page_count">
          <th mat-header-cell *matHeaderCellDef>Pages</th>
          <td mat-cell *matCellDef="let doc">{{ doc.page_count }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let doc">
            <button mat-icon-button color="warn" (click)="deleteDocument(doc)" matTooltip="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div class="no-docs" *ngIf="documents.length === 0">
        <mat-icon>folder_open</mat-icon>
        <p>No documents indexed yet. Upload some files to get started!</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
